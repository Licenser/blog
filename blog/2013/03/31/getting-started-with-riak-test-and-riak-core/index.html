
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Getting Started With Riak_test and Riak_core - Lice!</title>
  <meta name="author" content="Heinz N. 'Licenser' Gies">

  
  <meta name="description" content="If you don&rsquo;t know what riak_core is, or don&rsquo;t have a riak_core based application you&rsquo;ll probably not take too much practical use of &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.licenser.net/blog/2013/03/31/getting-started-with-riak-test-and-riak-core">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Lice!" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-31493882-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Lice!</a></h1>
  
    <h2>...</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.licenser.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Getting Started With Riak_test and Riak_core</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-31T07:30:00+02:00" pubdate data-updated="true">Mar 31<span>st</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>If you don&rsquo;t know what <code>riak_core</code> is, or don&rsquo;t have a <code>riak_core</code> based application you&rsquo;ll probably not take too much practical use of this posts you might want to start with <a href="https://github.com/rzezeski/try-try-try">Ryan Zezeski&rsquo;s &ldquo;working&rdquo; blog try try try</a> and the <a href="https://github.com/basho/rebar_riak_core">rebar plugin</a>.</p>

<p>That said if you have a <code>riak_core</code> app this posts should get you started on how to test it with <code>riak_test</code>. We&rsquo;ll not go through the topic of how to write the tests itself, this might come in a later post also the <code>riak_kv</code> tests are a good point to start.</p>

<p>Please note that the approach described here is what I choose to do, it might not be best practice of the best way for you to do things. I also will link to <a href="https://github.com/Licenser/riak_test">my fork</a> of <code>riak_test</code> instead of the <a href="https://github.com/basho/riak_test">official one</a> since it includes some modifications required for testing apps other then <code>riak_kv</code> I hope those modifications will be merged back at some point but for now I want to get it ironed out a bit more before making a pull request.</p>

<h2>What is riak_test?</h2>

<p>So before we start a few words to <code>riak_test</code>. <code>riak_test</code> is a pretty nice framework for testing distributed applications, it is, just as about all other <code>riak_</code> stuff created by <a href="http://basho.com">Basho</a> and it is pretty darn awesome.</p>

<p>At it&rsquo;s current state it is very focused on testing <code>riak_kv</code> (or <code>riak</code> as in the database) but from a first glance a lot of functionality is very universal and after all <code>riak_core</code> is also build on top of <code>riak_core</code>, so modifying it to run with other <code>riak_core</code> based apps is pretty easy.</p>

<h2>The setup</h2>

<p>Since I will be testing multiple <code>riak_core</code> apps and not just one I decided to go the following path: Have the entire setup in a git repository, then have one branch for general fixes/changed to <code>riak_core</code> then have one branch for each application I want to test that is based on the general branch so common changes can easily be merged so it will look like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>---riak_test--------- (bashos master tree)
</span><span class='line'>   `---riak_core----- (modifications to make riak_test work with core apps)
</span><span class='line'>    ` `  `---sniffle- (tests for sniffle)
</span><span class='line'>     ` `---snarl----- (tests for snarl)
</span><span class='line'>      `---howl------- (tests for howl)</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ll go over this and setting up tests for the <a href="https://github.com/project-fifo/howl">howl application</a> it&rsquo;s rather small and simple and it&rsquo;s easier to follow along with something real instead of a made up situation.</p>

<h2>Getting started</h2>

<p>Step one of getting started is to get a clone from the <code>riak_test</code> repository, that&rsquo;s pretty simple (alter the path if you decided to fork):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd ~/Projects
</span><span class='line'>git clone https://github.com/Licenser/riak_test.git
</span><span class='line'>cd riak_test</span></code></pre></td></tr></table></div></figure>


<p>Now we branch of to have a place to get our howl application but first we need to checkout the riak_core branch to make sure we get the changes included in it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git checkout riak_core
</span><span class='line'>git branch howl
</span><span class='line'>git checkout howl</span></code></pre></td></tr></table></div></figure>


<p>Okay that&rsquo;s it for the basic setup not that bad so far is it?</p>

<h2>Configuration</h2>

<p>Next thing we need to do is creating a configuration, at this point we assume you don&rsquo;t have any yet so we&rsquo;ll start from scratch, if you add more then one application later on you can just add them to an existing configuration.</p>

<p><code>riak_test</code> looks for the configuration file <code>~/.riak_test.config</code> and reads all the data from there so we&rsquo;ll first need to copy the sample config there:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cp riak_test.config.sample ~/.riak_test.config</span></code></pre></td></tr></table></div></figure>


<p>Next step is to open it in your favourite editor, you&rsquo;ll recognise it&rsquo;s a good old Erlang config file with tuples to group sections. We&rsquo;ll be ignoring the <code>default</code> section for now, if you&rsquo;re interested in it the documentation is quite good!</p>

<p>So lets go down to where it reads:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="c">%% ===============================================================</span>
</span><span class='line'><span class="c">%%  Project-specific configurations</span>
</span><span class='line'><span class="c">%% ===============================================================</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here is where the fun starts, you&rsquo;ll see a tuple starting with <code>{rtdev,</code> &ndash; note this <code>rtdev</code> has nothing whatsoever to do with the <code>rtdev</code> that is in the <code>default</code> section as <code>{rt_harness, rtdev}</code>. The <code>rtdev</code> in the project part is just the name of the project, since your project is named <code>howl</code> not <code>rtdev</code> we&rsquo;ll go and change that first.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="p">{</span><span class="n">rtdev</span><span class="p">,</span> <span class="p">[</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we can go to set up some variables first up the project name and executables, the name itself is just for information (or if you use <code>giddyup</code>) the executables are how your application is started, since our application is named <code>howl</code> it&rsquo;s started with the command <code>howl</code> and the admin command for it is <code>howl-admin</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="c">%% The name of the project/product, used when fetching the test</span>
</span><span class='line'><span class="c">%% suite and reporting.</span>
</span><span class='line'><span class="p">{</span><span class="n">rt_project</span><span class="p">,</span> <span class="s">&quot;howl&quot;</span><span class="p">},</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span><span class="n">rc_executable</span><span class="p">,</span> <span class="s">&quot;howl&quot;</span><span class="p">},</span>
</span><span class='line'><span class="p">{</span><span class="n">rc_admin</span><span class="p">,</span> <span class="s">&quot;howl-admin&quot;</span><span class="p">},</span>
</span></code></pre></td></tr></table></div></figure>


<p>With that done come the services, those are the buggers you register in your _app.erl file, lets have a look at the howl_app.erl:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="c">%...</span>
</span><span class='line'>            <span class="n">ok</span> <span class="o">=</span> <span class="nn">riak_core_node_watcher</span><span class="p">:</span><span class="nf">service_up</span><span class="p">(</span><span class="n">howl</span><span class="p">,</span> <span class="n">self</span><span class="p">()),</span>
</span><span class='line'><span class="c">%...</span>
</span></code></pre></td></tr></table></div></figure>


<p>So we only have one service here we need to watch out for, named, you might guess … right <code>howl</code> that makes the list rather short:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="p">{</span><span class="n">rc_services</span><span class="p">,</span> <span class="p">[</span><span class="n">howl</span><span class="p">]},</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now the cookie, it&rsquo;s a bit hidden in the code that you need to set it but you do, you will need this later so remember it! Since I am bad at remembering things I named it … <code>howl</code> … again.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="p">{</span><span class="n">rt_cookie</span><span class="p">,</span> <span class="n">howl</span><span class="p">},</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now comes the setup of paths, for this we&rsquo;ve to decide where we want to put our data later on, I&rsquo;ve put all my <code>riak_test</code> things in <code>/Users/heinz/rt/...</code> so we&rsquo;ll follow with this. Also note that my development process works on three branches:</p>

<ul>
<li><code>test</code> &ndash; the most unstable branch.</li>
<li><code>dev</code> &ndash; here things go that should work.</li>
<li><code>master</code> &ndash; only full releases go in here.</li>
</ul>


<p>This setup might not work for you at all, but since it are only path names it should be easy enough to adept the.</p>

<p>Note that by default <code>riak_test</code> will run tests on the <code>current</code> environment</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="c">%% Paths to the locations of various versions of the project. This</span>
</span><span class='line'><span class="c">%% is only valid for the `rtdev&#39; harness.</span>
</span><span class='line'><span class="p">{</span><span class="n">rtdev_path</span><span class="p">,</span> <span class="p">[</span>
</span><span class='line'>              <span class="c">%% This is the root of the built `rtdev&#39; repository,</span>
</span><span class='line'>              <span class="c">%% used for manipulating the repo with git. All</span>
</span><span class='line'>              <span class="c">%% versions should be inside this directory.</span>
</span><span class='line'>              <span class="p">{</span><span class="n">root</span><span class="p">,</span> <span class="s">&quot;/Users/heinz/rt/howl&quot;</span><span class="p">},</span>
</span><span class='line'>
</span><span class='line'>              <span class="c">%% The path to the `current&#39; version, which is used</span>
</span><span class='line'>              <span class="c">%% exclusively except during upgrade tests.</span>
</span><span class='line'>              <span class="p">{</span><span class="n">current</span><span class="p">,</span> <span class="s">&quot;/Users/heinz/rt/howl/howl-test&quot;</span><span class="p">},</span>
</span><span class='line'>
</span><span class='line'>              <span class="c">%% The path to the most immediately previous version</span>
</span><span class='line'>              <span class="c">%% of the project, which is used when doing upgrade</span>
</span><span class='line'>              <span class="c">%% tests.</span>
</span><span class='line'>              <span class="p">{</span><span class="n">previous</span><span class="p">,</span> <span class="s">&quot;/Users/heinz/rt/howl/howl-dev&quot;</span><span class="p">},</span>
</span><span class='line'>
</span><span class='line'>              <span class="c">%% The path to the version before `previous&#39;, which</span>
</span><span class='line'>              <span class="c">%% is used when doing upgrade tests.</span>
</span><span class='line'>              <span class="p">{</span><span class="n">legacy</span><span class="p">,</span> <span class="s">&quot;/Users/heinz/rt/howl/howl-stable&quot;</span><span class="p">}</span>
</span><span class='line'>             <span class="p">]}</span>
</span><span class='line'><span class="p">]}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And that&rsquo;s it now the config is set up and should look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="p">{</span><span class="n">rtdev</span><span class="p">,</span> <span class="p">[</span>
</span><span class='line'>    <span class="c">%% The name of the project/product, used when fetching the test</span>
</span><span class='line'>    <span class="c">%% suite and reporting.</span>
</span><span class='line'>    <span class="p">{</span><span class="n">rt_project</span><span class="p">,</span> <span class="s">&quot;howl&quot;</span><span class="p">},</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">{</span><span class="n">rc_executable</span><span class="p">,</span> <span class="s">&quot;rhowl&quot;</span><span class="p">},</span>
</span><span class='line'>    <span class="p">{</span><span class="n">rc_admin</span><span class="p">,</span> <span class="s">&quot;howl-admin&quot;</span><span class="p">},</span>
</span><span class='line'>    <span class="p">{</span><span class="n">rc_services</span><span class="p">,</span> <span class="p">[</span><span class="n">howl</span><span class="p">]},</span>
</span><span class='line'>    <span class="p">{</span><span class="n">rt_cookie</span><span class="p">,</span> <span class="n">howl</span><span class="p">},</span>
</span><span class='line'>    <span class="c">%% Paths to the locations of various versions of the project. This</span>
</span><span class='line'>    <span class="c">%% is only valid for the `rtdev&#39; harness.</span>
</span><span class='line'>    <span class="p">{</span><span class="n">rtdev_path</span><span class="p">,</span> <span class="p">[</span>
</span><span class='line'>                  <span class="c">%% This is the root of the built `rtdev&#39; repository,</span>
</span><span class='line'>                  <span class="c">%% used for manipulating the repo with git. All</span>
</span><span class='line'>                  <span class="c">%% versions should be inside this directory.</span>
</span><span class='line'>                  <span class="p">{</span><span class="n">root</span><span class="p">,</span> <span class="s">&quot;/Users/heinz/rt/howl&quot;</span><span class="p">},</span>
</span><span class='line'>
</span><span class='line'>                  <span class="c">%% The path to the `current&#39; version, which is used</span>
</span><span class='line'>                  <span class="c">%% exclusively except during upgrade tests.</span>
</span><span class='line'>                  <span class="p">{</span><span class="n">current</span><span class="p">,</span> <span class="s">&quot;/Users/heinz/rt/howl/howl-test&quot;</span><span class="p">},</span>
</span><span class='line'>
</span><span class='line'>                  <span class="c">%% The path to the most immediately previous version</span>
</span><span class='line'>                  <span class="c">%% of the project, which is used when doing upgrade</span>
</span><span class='line'>                  <span class="c">%% tests.</span>
</span><span class='line'>                  <span class="p">{</span><span class="n">previous</span><span class="p">,</span> <span class="s">&quot;/Users/heinz/rt/howl/howl-dev&quot;</span><span class="p">},</span>
</span><span class='line'>
</span><span class='line'>                  <span class="c">%% The path to the version before `previous&#39;, which</span>
</span><span class='line'>                  <span class="c">%% is used when doing upgrade tests.</span>
</span><span class='line'>                  <span class="p">{</span><span class="n">legacy</span><span class="p">,</span> <span class="s">&quot;/Users/heinz/rt/howl/howl-stable&quot;</span><span class="p">}</span>
</span><span class='line'>                 <span class="p">]}</span>
</span><span class='line'><span class="p">]}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Setting up the application</h2>

<p>We&rsquo;ve <code>riak_test</code> ready to test now next we need to prepare howl to be tested, we&rsquo;ll only look at the <code>current</code> (aka <code>test</code>) setup since the steps for others are pretty much the same.</p>

<p>The first step is that we need the folder, so lets create it</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="nv">Users</span><span class="o">/</span><span class="n">heinz</span><span class="o">/</span><span class="n">rt</span><span class="o">/</span><span class="n">raw</span><span class="o">/</span><span class="n">howl</span>
</span><span class='line'><span class="n">cd</span> <span class="o">/</span><span class="nv">Users</span><span class="o">/</span><span class="n">heinz</span><span class="o">/</span><span class="n">rt</span><span class="o">/</span><span class="n">raw</span><span class="o">/</span><span class="n">howl</span>
</span></code></pre></td></tr></table></div></figure>


<p>Since howl lives with the octocat on github it&rsquo;s easy to fetch our application and checkout the test branch (remember <code>current</code> is on the test branch for me):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="n">git</span> <span class="n">clone</span> <span class="nn">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">project</span><span class="o">-</span><span class="n">fifo</span><span class="o">/</span><span class="n">howl</span><span class="p">.</span><span class="n">git</span> <span class="n">howl</span><span class="o">-</span><span class="n">test</span>
</span><span class='line'><span class="n">cd</span> <span class="n">howl</span><span class="o">-</span><span class="n">test</span>
</span><span class='line'><span class="n">git</span> <span class="n">checkout</span> <span class="n">test</span>
</span></code></pre></td></tr></table></div></figure>


<p>And done, now since it&rsquo;s a <code>riak_core</code> app we should have a task called <code>stagedevrel</code> in our makefile which will basically generate three copies of <code>howl</code> for us in the folders <code>dev/dev{1,2,3}</code> and in the process take care of compiling and getting the dependencies. I prefer <code>stagedevrel</code> over the normal <code>devrel</code> since later on it will it easier to recompile code files (<code>make</code> is enough) because it links them to the right place instead of copying the.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="n">make</span> <span class="n">stagedevrel</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we&rsquo;ve to do a bit of a cheating, riak_text expects the root dir to be a git repository, that is why we can&rsquo;t just put the data in there directly, so we&rsquo;ve to manually build the tree for riak core and set up as git repositor.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="nv">Users</span><span class="o">/</span><span class="n">heinz</span><span class="o">/</span><span class="n">rt</span><span class="o">/</span><span class="n">howl</span>
</span><span class='line'><span class="n">cd</span> <span class="o">/</span><span class="nv">Users</span><span class="o">/</span><span class="n">heinz</span><span class="o">/</span><span class="n">rt</span><span class="o">/</span><span class="n">howl</span>
</span><span class='line'><span class="n">git</span> <span class="n">init</span>
</span><span class='line'>
</span><span class='line'><span class="n">cat</span> <span class="o">&lt;&lt;</span><span class="nv">EOF</span> <span class="o">&gt;</span> <span class="o">/</span><span class="nv">Users</span><span class="o">/</span><span class="n">heinz</span><span class="o">/</span><span class="n">rt</span><span class="o">/</span><span class="n">howl</span><span class="o">/</span><span class="p">.</span><span class="n">gitignore</span>
</span><span class='line'><span class="o">*/</span><span class="n">dev</span><span class="o">/*/</span><span class="n">bin</span>
</span><span class='line'><span class="o">*/</span><span class="n">dev</span><span class="o">/*/</span><span class="n">erts</span><span class="o">-*</span>
</span><span class='line'><span class="o">*/</span><span class="n">dev</span><span class="o">/*/</span><span class="n">lib</span>
</span><span class='line'><span class="o">*/</span><span class="n">dev</span><span class="o">/*/</span><span class="n">releases</span>
</span><span class='line'><span class="nv">EOF</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we need to link our devrel files and for my setup I&rsquo;ve to copy the <code>*.example</code> files of the <code>app.config</code> and <code>vm.args</code> into the right place they might be named differently for you.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="n">export</span> <span class="nv">RT_BASE</span><span class="o">=/</span><span class="nv">Users</span><span class="o">/</span><span class="n">heinz</span><span class="o">/</span><span class="n">rt</span><span class="o">/</span><span class="n">howl</span><span class="o">/</span><span class="n">howl</span><span class="o">-</span><span class="n">test</span>
</span><span class='line'><span class="n">export</span> <span class="nv">RC_BASE</span><span class="o">=/</span><span class="nv">Users</span><span class="o">/</span><span class="n">heinz</span><span class="o">/</span><span class="n">rt</span><span class="o">/</span><span class="n">raw</span><span class="o">/</span><span class="n">howl</span><span class="o">/</span><span class="n">howl</span><span class="o">-</span><span class="n">test</span>
</span><span class='line'><span class="n">for</span> <span class="n">i</span> <span class="n">in</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span>
</span><span class='line'><span class="n">do</span>
</span><span class='line'>  <span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="sc">${</span><span class="nv">RT_BASE</span><span class="p">}</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">dev</span><span class="sc">${</span><span class="n">i</span><span class="p">}</span><span class="o">/</span>
</span><span class='line'>  <span class="n">cd</span> <span class="sc">${</span><span class="nv">RT_BASE</span><span class="p">}</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">dev</span><span class="sc">${</span><span class="n">i</span><span class="p">}</span><span class="o">/</span>
</span><span class='line'>  <span class="n">mkdir</span> <span class="n">data</span> <span class="n">etc</span>
</span><span class='line'>  <span class="n">touch</span> <span class="n">data</span><span class="o">/</span><span class="p">.</span><span class="n">gitignore</span>
</span><span class='line'>  <span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="sc">${</span><span class="nv">RC_BASE</span><span class="p">}</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">dev</span><span class="sc">${</span><span class="n">i</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">bin</span><span class="p">,</span><span class="n">erts</span><span class="o">-*</span><span class="p">,</span><span class="n">lib</span><span class="p">,</span><span class="n">releases</span><span class="p">}</span> <span class="p">.</span>
</span><span class='line'>  <span class="n">cp</span> <span class="sc">${</span><span class="nv">RC_BASE</span><span class="p">}</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">dev</span><span class="sc">${</span><span class="n">i</span><span class="p">}</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">vm</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="n">example</span> <span class="n">etc</span><span class="o">/</span><span class="n">vm</span><span class="p">.</span><span class="n">args</span>
</span><span class='line'>  <span class="n">cp</span> <span class="sc">${</span><span class="nv">RC_BASE</span><span class="p">}</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">dev</span><span class="sc">${</span><span class="n">i</span><span class="p">}</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">example</span> <span class="n">etc</span><span class="o">/</span><span class="n">app</span><span class="p">.</span><span class="n">config</span>
</span><span class='line'><span class="n">done</span>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>We still need to edit the <code>vm.args</code> in <code>dev/dev{1,2,3,4}/etc/</code>  since we need to set the correct cookie &ndash; I hope you still remember yours, I told you you&rsquo;d need it (if not you can just look in the <code>~/.riak_test.config</code>)!</p>

<p>That&rsquo;s it.</p>

<h2>Running a first test</h2>

<p>In the <code>riak_core</code> branch of <code>riak_test</code> I&rsquo;ve moved all the <code>riak_kv</code> specific tests from <code>tests</code> to <code>tests_riakkv</code> so you still can look at them but I left one of them in <code>tests</code>, namely the basic command test &ndash; it will check if your applications command (<code>howl</code> in our case) is well behaved.</p>

<p>We&rsquo;ll want to run it to see if <code>howl</code> is a good boy and does well to do so we&rsquo;ll need to get back into the <code>riak_test</code> folder and run the <code>riak_test</code> command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="n">cd</span> <span class="err">~</span><span class="o">/</span><span class="nv">Projects</span><span class="o">/</span><span class="n">riak_test</span>
</span><span class='line'><span class="p">.</span><span class="o">/</span><span class="n">riak_test</span> <span class="o">-</span><span class="n">t</span> <span class="n">tests</span><span class="o">/*</span> <span class="o">-</span><span class="n">c</span> <span class="n">howl</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">b</span> <span class="n">none</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;d like to explain this a bit, the arguments have the following meaning:</p>

<ul>
<li><code>-t tests/*</code> &ndash; we&rsquo;ll be running all tests in the folder <code>tests/</code>.</li>
<li><code>-c howl</code> &ndash; our application we want to test is named howl, this is the first element of the tuple we put in our config file when you remember.</li>
<li><code>-v</code> &ndash; This just turns on verbose output.</li>
<li><code>-b none</code> &ndash; This is still a relict from the <code>riak_kv</code> roots, it means which backend to test with, since we don&rsquo;t have backends at all we&rsquo;ll just pass none which means riak_test will happily ignore it.</li>
</ul>


<p>That&rsquo;s it! Now go and test all the things!</p>

<p>This is the first part of a series that goes on <a href="/blog/2013/04/09/writing-your-first-riak-test-test-yes-i-know-there-are-two-tests-there/">here</a>.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Heinz N. 'Licenser' Gies</span></span>

      








  


<time datetime="2013-03-31T07:30:00+02:00" pubdate data-updated="true">Mar 31<span>st</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/erlang/'>Erlang</a>, <a class='category' href='/blog/categories/project-fifo/'>Project-FiFo</a>, <a class='category' href='/blog/categories/riak/'>riak</a>, <a class='category' href='/blog/categories/riak-test/'>riak_test</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://blog.licenser.net/blog/2013/03/31/getting-started-with-riak-test-and-riak-core/" data-via="heinz_gies" data-counturl="http://blog.licenser.net/blog/2013/03/31/getting-started-with-riak-test-and-riak-core/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/03/19/plugins-with-erlang/" title="Previous Post: Plugins with Erlang">&laquo; Plugins with Erlang</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/04/09/writing-your-first-riak-test-test-yes-i-know-there-are-two-tests-there/" title="Next Post: Writing your first riak test test (yes I know there are two tests there)">Writing your first riak test test (yes I know there are two tests there) &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/11/28/postmortom-of-a-interesting-bug/">Postmortom of a Interesting Bug</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/02/post-mortem-of-a-failed-support-case/">Post-mortem of a Failed Support Case.</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/01/backups-with-project-fifo/">Backups With Project FiFo</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/13/a-asynchronous-gced-or-set/">A Asynchronously GCed or Set</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/11/asyncronous-garbage-collection-with-crdts/">Asynchronous Garbage Collection With CRDTs</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/Licenser">@Licenser</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'Licenser',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Heinz N. 'Licenser' Gies -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'lice';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.licenser.net/blog/2013/03/31/getting-started-with-riak-test-and-riak-core/';
        var disqus_url = 'http://blog.licenser.net/blog/2013/03/31/getting-started-with-riak-test-and-riak-core/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
